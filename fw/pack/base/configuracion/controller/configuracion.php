<?phpclass Configuracion extends Maestro{    CONST WIDHT = "90";    CONST HEIGHT = "90";    CONST EXITO_CONFIGURACION="057";    CONST PERFIL_ADMIN = 1;    CONST WIDHT_LOGO = 290;    CONST HEIGHT_LOGO = 80;    CONST CARPETA= "media/img/";    CONST CARPETA_PERFIL_DEFAULT="fw/vista/themes/bar/img/default/";    CONST CARPETA_INTERLOCUTOR="media/img/logo/";    CONST CARPETA_PRODUCTO_DEFAULT="media/img/producto/";    public function __construct($db = "",$modulo ="") {        $this->modulo = 'Configuracion';        $this->nombre_tabla = 'fw_interlocutor_configuracion';        $this->primary_key = 'id_'.$this->nombre_tabla;        $this->actualizacion_ajax='html';      /*  $this->EXITO_CREACION   = "036";        $this->EXITO_EDICION    = "037";        $this->EXITO_ELIMINAR   = "038"; */        parent::__construct($db ,$this->modulo);        $perfil = $this->gn->get_data_loged('perfil');        $marcablanca=$this->gn->get_data_loged('marca_blanca');        $id_interlocutor=$this->gn->get_data_loged('id_interlocutor');        $id_usuario=$this->gn->get_data_loged('id_usuario');        $tema_interlocutor = $this->db->selectOne('t.descripcion', 'fw_tema t,fw_interlocutor_condicion i', 'i.tema_id=t.id_tema and i.interlocutor_id=' . $id_interlocutor);        $campos_formulario['imagen_perfil'] = array('tipo'=>'img','height'=>'90','width'=>'90','ruta'=>self::CARPETA.'big/'.$id_usuario.'.jpg','tag'=>'img','complemento'=>'onerror="default_imagen(\'imagen_perfil\',\''.self::CARPETA_PERFIL_DEFAULT.'big/'.$id_usuario.".jpg".'\')"','complemento'=>'onerror="default_imagen(\'imagen_perfil\',\'fw/vista/themes/'.$tema_interlocutor['descripcion'].'/img/default_perfil.png\')"');        $campos_formulario['imagen_perfil_f'] = array('tipo'=>'file','complemento'=>' onchange="visualizar_img(this,'."'".'imagen_perfil'."'".','."'".'90'."'".','."'".'90'."'".')"','label'=>'');                if (in_array($perfil, array(self::PERFIL_ADMIN))) {                     $campos_formulario['id_interlocutor_marcablanca'] = array('tipo'=>'hidden','complemento'=>'required');            $campos_formulario['imagen_logo'] = array('tipo'=>'img','height'=>'90','width'=>'90','ruta'=>self::CARPETA.'/img/logo/big/'.$marcablanca.'.jpg','tag'=>'img','complemento'=>'onerror="default_imagen(\'imagen_logo\',\'fw/vista/themes/'.$tema_interlocutor['descripcion'].'/img/default_logo.png\')"');//,'default'=>'fw/vista/themes/'.$tema_interlocutor['descripcion'].'/img/default_logo.png'            $campos_formulario['nombre_imagen_logo'] = array('tipo'=>'file','complemento'=>' onchange="visualizar_img(this,'."'".'imagen_logo'."'".','."'".'100'."'".','."'".'50'."'".')"','label'=>'' );            $campos_formulario['imagen_default_producto'] = array('tipo'=>'img','height'=>'90','width'=>'90','ruta'=>self::CARPETA_PRODUCTO_DEFAULT.'big/'.$marcablanca.'.jpg','tag'=>'img','complemento'=>'onerror="default_imagen(\'imagen_default_producto\',\''.self::CARPETA_PRODUCTO_DEFAULT.'big/'.$marcablanca.".jpg".'\')"','label'=>'default producto');//,'default'=>'fw/vista/themes/'.$tema_interlocutor['descripcion'].'/img/default_logo.png'            $campos_formulario['nombre_imagen_default_producto'] = array('tipo'=>'file','complemento'=>' onchange="visualizar_img(this,'."'".'imagen_default_producto'."'".','."'".'100'."'".','."'".'50'."'".')"','label'=>'' );            //$campos_formulario['tema_id']=  array('tipo'=>'hidden','valor'=>'','complemento'=>'required', 'campo'=>'descripcion', 'condicion'=>'estado_id='.self::ESTADO_ACTIVO,'tag'=>'select');            $campos_formulario['fuente_id']=  array('tipo' => 'select', 'valor' => '', 'complemento' => 'required','tag'=>'select',                                                                 'campo' => 'f.descripcion',                                                                 'valor' => 'f.id_fuente',                                                                'condicion' => 'f.estado_id='.self::ESTADO_ACTIVO,                                                                'tabla' => 'fw_fuente f');            $campos_formulario['titulo_sitio'] = array('tipo'=>'hidden','complemento'=>'required');            //$campos_formulario['id_opcion'] = array('tipo'=>'select','value'=>'id_opcion','tabla'=>'opcion','complemento'=>'required','campo'=>'descripcion','condicion'=>'estado_id='.self::ESTADO_ACTIVO.' AND opcion_id !=0','tag'=>'select','label'=>'Default Option');        }           $this->campos_formulario = $campos_formulario;            }    function home() {        $this->nc->verificar_notificacion();        $perfil = $this->gn->get_data_loged('perfil');          $id_interlocutor = $this->gn->get_data_loged('id_interlocutor');        $usuario=$this->gn->get_data_loged('id_usuario');        $campos_formulario = $this->campos_formulario;        if (in_array($perfil, array(self::PERFIL_ADMIN))) {            // de campos borre la imagen_perfil y el id_interlocutor_configuracion ya que solo se usan en el caso que no sea admin            $campos = array('im.fuente_id', 'ic.titulo_sitio');//'ic.tema_id','uc.imagen_perfil'            $tablas =   'fw_interlocutor_marcablanca im                        JOIN fw_interlocutor_configuracion ic JOIN fw_opcion o                        ON ic.marca_blanca = im.id_interlocutor_marcablanca';            $condicion = "ic.interlocutor_id='$id_interlocutor'";        } else {            $campos = array('ic.id_interlocutor_configuracion');//'ic.imagen_perfil'            $tablas =   'fw_interlocutor_configuracion ic';            $condicion = "ic.interlocutor_id='$id_interlocutor'";        }        $configuracion = $this->db->selectOne($campos,$tablas,$condicion);                if($configuracion){                        foreach ($configuracion as $key => $value) {                       $campos_formulario[$key]['valor'] = $value;            }        }        $accion = 'guardar_edicion';		require_once(self::PATH_PLUGINS."maestro/view/maestro2.html.php");        FormHTML::formulario_dinamico($campos_formulario, $accion, $this->modulo, $this->db,'',array(),'',$retorno='','ConfiguraciÃ³n','',$this->actualizacion_ajax,$this->area_actualizacion);    }    function guardar_edicion($redirect = true, $parametros = null){        $this->tipo_contenido = '';        if (is_null($parametros)) {			$parametros = $this->gn->traer_parametros('POST');		}		$id_interlocutor=$this->gn->get_data_loged('id_interlocutor');               $interlocutor_configuracion = array();         $fuente=$parametros->fuente_id;        $marcablanca=$this->gn->get_data_loged('marca_blanca');        unset($parametros->fuente_id);        foreach ($parametros as $key => $value) {            $interlocutor_configuracion[$key]=$value;        }        /*foreach ($interlocutor_configuracion as $key => $value) {            $update_ic_item=$this->db->update(array($key =>$value),'fw_interlocutor_configuracion','interlocutor_id='.$id_interlocutor);        }*/        $update_fuente=$this->db->update(array('fuente_id' =>$fuente),'fw_interlocutor_marcablanca','interlocutor_id='.$id_interlocutor);        //$id_interlocutor_configuracion = $parametros->id_interlocutor_configuracion;        /* CAPTURA IMAGEN */                if (isset($_FILES['imagen_perfil_f']['name'])){            $id_usuario=$this->gn->get_data_loged('id_usuario');             $resultado = $this->gn->generar_imagenes(self::CARPETA, self::WIDHT, self::HEIGHT, $_FILES['imagen_perfil_f'],false,$id_usuario);            if ($resultado->respuesta == true){                $parametros->imagen_perfil = $resultado->descripcion;            } else{                echo "error al carga imagen";            }        }                if (isset($_FILES['nombre_imagen_logo']['name'])){            $resultado = $this->gn->generar_imagenes(self::CARPETA_INTERLOCUTOR, self::WIDHT, self::HEIGHT, $_FILES['nombre_imagen_logo'],false,$marcablanca);                        if ($resultado->respuesta == true){                $parametros->imagen_logo = $resultado->descripcion;            } else{                echo "error al carga imagen";            }        }        if (isset($_FILES['nombre_imagen_default_producto']['name'])){            $resultado = $this->gn->generar_imagenes(self::CARPETA, self::WIDHT, self::HEIGHT, $_FILES['nombre_imagen_default_producto'],false,$marcablanca);            //var_dump($resultado);exit;            if ($resultado->respuesta == true){                $parametros->imagen_logo = $resultado->descripcion;            } else{                echo "error al carga imagen";            }        }        //$update_perfil=$this->db->update(array('imagen_perfil' =>$parametros['imagen_perfil']),'fw_interlocutor_condicion','interlocutor_id='.$id_interlocutor);        $mensaje = $this->nc->traer_mensaje_respuesta(self::EXITO_CONFIGURACION);        $this->nc->set_notificacion(utf8_encode($mensaje['descripcion']));        header('location:?opcion=subopcion&id=1&type=html');    }   }